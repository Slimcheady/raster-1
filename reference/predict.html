<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Spatial model predictions — predict • raster</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Spatial model predictions — predict" />
<meta property="og:description" content="Make a Raster object with predictions from a fitted model object (for example, obtained with lm, glm). The first argument is a Raster object with the independent (predictor) variables. The names in the Raster object should exactly match those expected by the model. This will be the case if the same Raster object was used (via extract) to obtain the values to fit the model (see the example). Any type of model (e.g. glm, gam, randomForest) for which a predict method has been implemented (or can be implemented) can be used.
This approach (predict a fitted model to raster data) is commonly used in remote sensing (for the classification of satellite images) and in ecology, for species distribution modeling." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">raster</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.5-0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/rspatial/raster/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Spatial model predictions</h1>
    
    <div class="hidden name"><code>predict.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Make a Raster object with predictions from a fitted model object (for example, obtained with <code>lm</code>, <code>glm</code>). The first argument is a Raster object with the independent (predictor) variables. The <code><a href='names.html'>names</a></code> in the Raster object should exactly match those expected by the model. This will be the case if the same Raster object was used (via <code>extract</code>) to obtain the values to fit the model (see the example). Any type of model (e.g. glm, gam, randomForest) for which a predict method has been implemented (or can be implemented) can be used.</p>
<p>This approach (predict a fitted model to raster data) is commonly used in remote sensing (for the classification of satellite images) and in ecology, for species distribution modeling.</p>
    </div>

    <pre class="usage"><span class='co'># S4 method for Raster</span>
<span class='fu'>predict</span><span class='op'>(</span><span class='va'>object</span>, <span class='va'>model</span>, filename<span class='op'>=</span><span class='st'>""</span>, fun<span class='op'>=</span><span class='va'>predict</span>, ext<span class='op'>=</span><span class='cn'>NULL</span>, 
   const<span class='op'>=</span><span class='cn'>NULL</span>, index<span class='op'>=</span><span class='fl'>1</span>, na.rm<span class='op'>=</span><span class='cn'>TRUE</span>, inf.rm<span class='op'>=</span><span class='cn'>FALSE</span>, factors<span class='op'>=</span><span class='cn'>NULL</span>, 
   <span class='va'>format</span>, <span class='va'>datatype</span>, overwrite<span class='op'>=</span><span class='cn'>FALSE</span>, progress<span class='op'>=</span><span class='st'>''</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>object</th>
      <td><p>Raster* object. Typically a multi-layer type (RasterStack or RasterBrick)</p></td>
    </tr>
    <tr>
      <th>model</th>
      <td><p>fitted model of any class that has a 'predict' method (or for which you can supply a similar method as <code>fun</code> argument. E.g. glm, gam, or randomForest</p></td>
    </tr>
    <tr>
      <th>filename</th>
      <td><p>character. Optional output filename</p></td>
    </tr>
    <tr>
      <th>fun</th>
      <td><p>function. Default value is 'predict', but can be replaced with e.g. predict.se (depending on the type of model), or your own custom function.</p></td>
    </tr>
    <tr>
      <th>ext</th>
      <td><p>Extent object to limit the prediction to a sub-region of <code>x</code></p></td>
    </tr>
    <tr>
      <th>const</th>
      <td><p>data.frame. Can be used to add a constant for which there is no Raster object for model predictions. Particularly useful if the constant is a character-like factor value for which it is currently not possible to make a RasterLayer</p></td>
    </tr>
    <tr>
      <th>index</th>
      <td><p>integer. To select the column(s) to use if predict.'model' returns a matrix with multiple columns</p></td>
    </tr>
    <tr>
      <th>na.rm</th>
      <td><p>logical. Remove cells with <code>NA</code> values in the predictors before solving the model (and return a <code>NA</code> value for those cells). This option prevents errors with models that cannot handle <code>NA</code> values. In most other cases this will not affect the output. An exception is when predicting with a boosted regression trees model because these return predicted values even if some (or all!) variables are <code>NA</code></p></td>
    </tr>
    <tr>
      <th>inf.rm</th>
      <td><p>logical. Remove cells with values that are not finite (some models will fail with -Inf/Inf values). This option is ignored when <code>na.rm=FALSE</code></p></td>
    </tr>
    <tr>
      <th>factors</th>
      <td><p>list with levels for factor variables. The list elements should be named with names that correspond to names in <code>object</code> such that they can be matched. This argument may be omitted for standard models such as 'glm' as the predict function will extract the levels from the <code>model</code> object, but it is necessary in some other cases (e.g. cforest models from the party package)</p></td>
    </tr>
    <tr>
      <th>format</th>
      <td><p>character. Output file type. See <a href='writeRaster.html'>writeRaster</a> (optional)</p></td>
    </tr>
    <tr>
      <th>datatype</th>
      <td><p>character. Output data type. See <a href='dataType.html'>dataType</a> (optional)</p></td>
    </tr>
    <tr>
      <th>overwrite</th>
      <td><p>logical. If TRUE, "filename" will be overwritten if it exists</p></td>
    </tr>
    <tr>
      <th>progress</th>
      <td><p>character. "text", "window", or "" (the default, no progress bar)</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>additional arguments to pass to the predict.'model' function</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Use <code><a href='interpolate.html'>interpolate</a></code> if your model has 'x' and 'y' as implicit independent variables (e.g., in kriging).</p></div>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>RasterLayer or RasterBrick</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># A simple model to predict the location of the R in the R-logo using 20 presence points </span>
<span class='co'># and 50 (random) pseudo-absence points. This type of model is often used to predict</span>
<span class='co'># species distributions. See the dismo package for more of that.</span>

<span class='co'># create a RasterStack or RasterBrick with with a set of predictor layers</span>
<span class='va'>logo</span> <span class='op'>&lt;-</span> <span class='fu'><a href='brick.html'>brick</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"external/rlogo.grd"</span>, package<span class='op'>=</span><span class='st'>"raster"</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='names.html'>names</a></span><span class='op'>(</span><span class='va'>logo</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] "red"   "green" "blue" </div><div class='input'>
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'># the predictor variables</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mfrow<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='plotRGB.html'>plotRGB</a></span><span class='op'>(</span><span class='va'>logo</span>, main<span class='op'>=</span><span class='st'>'logo'</span><span class='op'>)</span>
<span class='fu'><a href='plot.html'>plot</a></span><span class='op'>(</span><span class='va'>logo</span>, <span class='fl'>1</span>, col<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grDevices/rgb.html'>rgb</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='fl'>0</span><span class='op'>:</span><span class='fl'>255</span>,<span class='fl'>0</span>,<span class='fl'>0</span><span class='op'>)</span>, maxColorValue<span class='op'>=</span><span class='fl'>255</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='plot.html'>plot</a></span><span class='op'>(</span><span class='va'>logo</span>, <span class='fl'>2</span>, col<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grDevices/rgb.html'>rgb</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0</span><span class='op'>:</span><span class='fl'>255</span>,<span class='fl'>0</span><span class='op'>)</span>, maxColorValue<span class='op'>=</span><span class='fl'>255</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='plot.html'>plot</a></span><span class='op'>(</span><span class='va'>logo</span>, <span class='fl'>3</span>, col<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grDevices/rgb.html'>rgb</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0</span>,<span class='fl'>0</span><span class='op'>:</span><span class='fl'>255</span><span class='op'>)</span>, maxColorValue<span class='op'>=</span><span class='fl'>255</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mfrow<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'># known presence and absence points</span>
<span class='va'>p</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>48</span>, <span class='fl'>48</span>, <span class='fl'>48</span>, <span class='fl'>53</span>, <span class='fl'>50</span>, <span class='fl'>46</span>, <span class='fl'>54</span>, <span class='fl'>70</span>, <span class='fl'>84</span>, <span class='fl'>85</span>, <span class='fl'>74</span>, <span class='fl'>84</span>, <span class='fl'>95</span>, <span class='fl'>85</span>, 
   <span class='fl'>66</span>, <span class='fl'>42</span>, <span class='fl'>26</span>, <span class='fl'>4</span>, <span class='fl'>19</span>, <span class='fl'>17</span>, <span class='fl'>7</span>, <span class='fl'>14</span>, <span class='fl'>26</span>, <span class='fl'>29</span>, <span class='fl'>39</span>, <span class='fl'>45</span>, <span class='fl'>51</span>, <span class='fl'>56</span>, <span class='fl'>46</span>, <span class='fl'>38</span>, <span class='fl'>31</span>, 
   <span class='fl'>22</span>, <span class='fl'>34</span>, <span class='fl'>60</span>, <span class='fl'>70</span>, <span class='fl'>73</span>, <span class='fl'>63</span>, <span class='fl'>46</span>, <span class='fl'>43</span>, <span class='fl'>28</span><span class='op'>)</span>, ncol<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span>

<span class='va'>a</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>22</span>, <span class='fl'>33</span>, <span class='fl'>64</span>, <span class='fl'>85</span>, <span class='fl'>92</span>, <span class='fl'>94</span>, <span class='fl'>59</span>, <span class='fl'>27</span>, <span class='fl'>30</span>, <span class='fl'>64</span>, <span class='fl'>60</span>, <span class='fl'>33</span>, <span class='fl'>31</span>, <span class='fl'>9</span>,
   <span class='fl'>99</span>, <span class='fl'>67</span>, <span class='fl'>15</span>, <span class='fl'>5</span>, <span class='fl'>4</span>, <span class='fl'>30</span>, <span class='fl'>8</span>, <span class='fl'>37</span>, <span class='fl'>42</span>, <span class='fl'>27</span>, <span class='fl'>19</span>, <span class='fl'>69</span>, <span class='fl'>60</span>, <span class='fl'>73</span>, <span class='fl'>3</span>, <span class='fl'>5</span>, <span class='fl'>21</span>,
   <span class='fl'>37</span>, <span class='fl'>52</span>, <span class='fl'>70</span>, <span class='fl'>74</span>, <span class='fl'>9</span>, <span class='fl'>13</span>, <span class='fl'>4</span>, <span class='fl'>17</span>, <span class='fl'>47</span><span class='op'>)</span>, ncol<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span>

<span class='co'># extract values for points</span>
<span class='va'>xy</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='va'>p</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='va'>a</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>v</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span>pa<span class='op'>=</span><span class='va'>xy</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span>, <span class='fu'><a href='extract.html'>extract</a></span><span class='op'>(</span><span class='va'>logo</span>, <span class='va'>xy</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>#build a model, here an example with glm </span>
<span class='va'>model</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span>formula<span class='op'>=</span><span class='va'>pa</span><span class='op'>~</span><span class='va'>.</span>, data<span class='op'>=</span><span class='va'>v</span><span class='op'>)</span>

<span class='co'>#predict to a raster</span>
<span class='va'>r1</span> <span class='op'>&lt;-</span> <span class='fu'>predict</span><span class='op'>(</span><span class='va'>logo</span>, <span class='va'>model</span>, progress<span class='op'>=</span><span class='st'>'text'</span><span class='op'>)</span>
</div><div class='output co'>#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |==================                                                    |  25%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================================                  |  75%  |                                                                              |======================================================================| 100%
#&gt; </div><div class='input'>
<span class='fu'><a href='plot.html'>plot</a></span><span class='op'>(</span><span class='va'>r1</span><span class='op'>)</span>
</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/points.html'>points</a></span><span class='op'>(</span><span class='va'>p</span>, bg<span class='op'>=</span><span class='st'>'blue'</span>, pch<span class='op'>=</span><span class='fl'>21</span><span class='op'>)</span>
</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/points.html'>points</a></span><span class='op'>(</span><span class='va'>a</span>, bg<span class='op'>=</span><span class='st'>'red'</span>, pch<span class='op'>=</span><span class='fl'>21</span><span class='op'>)</span>
</div><div class='img'><img src='predict-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># use a modified function to get a RasterBrick with p and se</span>
<span class='co'># from the glm model. The values returned by 'predict' are in a list,</span>
<span class='co'># and this list needs to be transformed to a matrix</span>

<span class='va'>predfun</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>model</span>, <span class='va'>data</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>v</span> <span class='op'>&lt;-</span> <span class='fu'>predict</span><span class='op'>(</span><span class='va'>model</span>, <span class='va'>data</span>, se.fit<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span>p<span class='op'>=</span><span class='fu'><a href='as.matrix.html'>as.vector</a></span><span class='op'>(</span><span class='va'>v</span><span class='op'>$</span><span class='va'>fit</span><span class='op'>)</span>, se<span class='op'>=</span><span class='fu'><a href='as.matrix.html'>as.vector</a></span><span class='op'>(</span><span class='va'>v</span><span class='op'>$</span><span class='va'>se.fit</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'># predfun returns two variables, so use index=1:2</span>
<span class='va'>r2</span> <span class='op'>&lt;-</span> <span class='fu'>predict</span><span class='op'>(</span><span class='va'>logo</span>, <span class='va'>model</span>, fun<span class='op'>=</span><span class='va'>predfun</span>, index<span class='op'>=</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>)</span>


<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'># You can use multiple cores to speed up the predict function</span>
<span class='co'># by calling it via the clusterR function (you may need to install the snow package)</span>
<span class='fu'><a href='cluster.html'>beginCluster</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>r1c</span> <span class='op'>&lt;-</span> <span class='fu'><a href='cluster.html'>clusterR</a></span><span class='op'>(</span><span class='va'>logo</span>, <span class='va'>predict</span>, args<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>model</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>r2c</span> <span class='op'>&lt;-</span> <span class='fu'><a href='cluster.html'>clusterR</a></span><span class='op'>(</span><span class='va'>logo</span>, <span class='va'>predict</span>, args<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>model<span class='op'>=</span><span class='va'>model</span>, fun<span class='op'>=</span><span class='va'>predfun</span>, index<span class='op'>=</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'># principal components of a RasterBrick</span>
<span class='co'># here using sampling to simulate an object too large</span>
<span class='co'># to feed all its values to prcomp</span>
<span class='va'>sr</span> <span class='op'>&lt;-</span> <span class='fu'><a href='sampleRandom.html'>sampleRandom</a></span><span class='op'>(</span><span class='va'>logo</span>, <span class='fl'>100</span><span class='op'>)</span>
<span class='va'>pca</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/prcomp.html'>prcomp</a></span><span class='op'>(</span><span class='va'>sr</span><span class='op'>)</span>

<span class='co'># note the use of the 'index' argument</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'>predict</span><span class='op'>(</span><span class='va'>logo</span>, <span class='va'>pca</span>, index<span class='op'>=</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span>
<span class='fu'><a href='plot.html'>plot</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</div><div class='img'><img src='predict-2.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'># partial least square regression</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/khliland/pls'>pls</a></span><span class='op'>)</span>
<span class='va'>model</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/pls/man/mvr.html'>plsr</a></span><span class='op'>(</span>formula<span class='op'>=</span><span class='va'>pa</span><span class='op'>~</span><span class='va'>.</span>, data<span class='op'>=</span><span class='va'>v</span><span class='op'>)</span>
<span class='co'># this returns an array:</span>
<span class='fu'>predict</span><span class='op'>(</span><span class='va'>model</span>, <span class='va'>v</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span>,<span class='op'>]</span><span class='op'>)</span>
<span class='co'># write a function to turn that into a matrix</span>
<span class='va'>pfun</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>data</span><span class='op'>)</span> <span class='op'>{</span>
   <span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'>predict</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>data</span><span class='op'>)</span>
   <span class='va'>d</span> <span class='op'>&lt;-</span> <span class='fu'><a href='dim.html'>dim</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span>
   <span class='fu'><a href='dim.html'>dim</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/prod.html'>prod</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span>, <span class='va'>d</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>
   <span class='va'>y</span>
<span class='op'>}</span>

<span class='va'>pp</span> <span class='op'>&lt;-</span> <span class='fu'>predict</span><span class='op'>(</span><span class='va'>logo</span>, <span class='va'>model</span>, fun<span class='op'>=</span><span class='va'>pfun</span>, index<span class='op'>=</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span>

<span class='co'># Random Forest</span>

<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://www.stat.berkeley.edu/~breiman/RandomForests/'>randomForest</a></span><span class='op'>)</span>
<span class='va'>rfmod</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/randomForest/man/randomForest.html'>randomForest</a></span><span class='op'>(</span><span class='va'>pa</span> <span class='op'>~</span><span class='va'>.</span>, data<span class='op'>=</span><span class='va'>v</span><span class='op'>)</span>

<span class='co'>## note the additional argument "type='response'" that is </span>
<span class='co'>## passed to predict.randomForest</span>
<span class='va'>r3</span> <span class='op'>&lt;-</span> <span class='fu'>predict</span><span class='op'>(</span><span class='va'>logo</span>, <span class='va'>rfmod</span>, type<span class='op'>=</span><span class='st'>'response'</span>, progress<span class='op'>=</span><span class='st'>'window'</span><span class='op'>)</span>

<span class='co'>## get a RasterBrick with class membership probabilities</span>
<span class='va'>vv</span> <span class='op'>&lt;-</span> <span class='va'>v</span>
<span class='va'>vv</span><span class='op'>$</span><span class='va'>pa</span> <span class='op'>&lt;-</span> <span class='fu'><a href='factors.html'>as.factor</a></span><span class='op'>(</span><span class='va'>vv</span><span class='op'>$</span><span class='va'>pa</span><span class='op'>)</span>
<span class='va'>rfmod2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/randomForest/man/randomForest.html'>randomForest</a></span><span class='op'>(</span><span class='va'>pa</span> <span class='op'>~</span><span class='va'>.</span>, data<span class='op'>=</span><span class='va'>vv</span><span class='op'>)</span>
<span class='va'>r4</span> <span class='op'>&lt;-</span> <span class='fu'>predict</span><span class='op'>(</span><span class='va'>logo</span>, <span class='va'>rfmod2</span>, type<span class='op'>=</span><span class='st'>'prob'</span>, index<span class='op'>=</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='spplot.html'>spplot</a></span><span class='op'>(</span><span class='va'>r4</span><span class='op'>)</span>


<span class='co'># cforest (other Random Forest implementation) example with factors argument</span>
<span class='va'>v</span><span class='op'>$</span><span class='va'>red</span> <span class='op'>&lt;-</span> <span class='fu'><a href='factors.html'>as.factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>v</span><span class='op'>$</span><span class='va'>red</span><span class='op'>/</span><span class='fl'>100</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>logo</span><span class='op'>$</span><span class='va'>red</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>logo</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>/</span><span class='fl'>100</span><span class='op'>)</span>

<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://party.R-forge.R-project.org'>party</a></span><span class='op'>)</span>
<span class='va'>m</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/party/man/cforest.html'>cforest</a></span><span class='op'>(</span><span class='va'>pa</span><span class='op'>~</span><span class='va'>.</span>, control<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/pkg/party/man/cforest_control.html'>cforest_unbiased</a></span><span class='op'>(</span>mtry<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>, data<span class='op'>=</span><span class='va'>v</span><span class='op'>)</span>
<span class='va'>f</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'><a href='factors.html'>levels</a></span><span class='op'>(</span><span class='va'>v</span><span class='op'>$</span><span class='va'>red</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='names.html'>names</a></span><span class='op'>(</span><span class='va'>f</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='st'>'red'</span>
<span class='co'># the second argument in party:::predict.RandomForest</span>
<span class='co'># is "OOB", and not "newdata" or similar. We need to write a wrapper</span>
<span class='co'># predict function to deal with this   </span>
<span class='va'>predfun</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>m</span>, <span class='va'>d</span>, <span class='va'>...</span><span class='op'>)</span> <span class='fu'>predict</span><span class='op'>(</span><span class='va'>m</span>, newdata<span class='op'>=</span><span class='va'>d</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='va'>pc</span> <span class='op'>&lt;-</span> <span class='fu'>predict</span><span class='op'>(</span><span class='va'>logo</span>, <span class='va'>m</span>, OOB<span class='op'>=</span><span class='cn'>TRUE</span>, factors<span class='op'>=</span><span class='va'>f</span>, fun<span class='op'>=</span><span class='va'>predfun</span><span class='op'>)</span>

<span class='co'># knn example, using calc instead of predict</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://www.stats.ox.ac.uk/pub/MASS4/'>class</a></span><span class='op'>)</span>
<span class='va'>cl</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fu'><a href='ncell.html'>nrow</a></span><span class='op'>(</span><span class='va'>p</span><span class='op'>)</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fu'><a href='ncell.html'>nrow</a></span><span class='op'>(</span><span class='va'>a</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>train</span> <span class='op'>&lt;-</span> <span class='fu'><a href='extract.html'>extract</a></span><span class='op'>(</span><span class='va'>logo</span>, <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span><span class='op'>(</span><span class='va'>p</span>, <span class='va'>a</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>k</span> <span class='op'>&lt;-</span> <span class='fu'><a href='calc.html'>calc</a></span><span class='op'>(</span><span class='va'>logo</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='fu'><a href='as.character.html'>as.character</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/class/man/knn.html'>knn</a></span><span class='op'>(</span><span class='va'>train</span>, <span class='va'>x</span>, <span class='va'>cl</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Robert J. Hijmans.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


