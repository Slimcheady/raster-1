<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Overlay Raster objects — overlay • raster</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Overlay Raster objects — overlay" />
<meta property="og:description" content="Create a new Raster* object, based on two or more Raster* objects. (You can also use a single object, but perhaps calc is what you are looking for in that case).
You should supply a function fun to set the way that the RasterLayers are combined. The number of arguments in the function must match the number of Raster objects (or take any number). For example, if you combine two RasterLayers you could use multiply: fun=function(x,y){return(x*y)} percentage: fun=function(x,y){return(100 * x / y)}. If you combine three layers you could use fun=function(x,y,z){return((x + y) * z)}
Note that the function must work for vectors (not only for single numbers). That is, it must return the same number of elements as its input vectors. Alternatively, you can also supply a function such as sum, that takes n arguments (as '...'), and perhaps also has a na.rm argument, like in sum(..., na.rm).
If a single mutli-layer object is provided, its layers are treated as individual RasterLayer objects if the argument unstack=TRUE is used. If multiple objects are provided, they should have the same number of layers, or it should be possible to recycle them (e.g., 1, 3, and 9 layers, which would return a RasterBrick with 9 layers)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">raster</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.5-5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/rspatial/raster/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Overlay Raster objects</h1>
    
    <div class="hidden name"><code>overlay.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Create a new Raster* object, based on two or more Raster* objects. (You can also use a single object, but perhaps <code><a href='calc.html'>calc</a></code> is what you are looking for in that case).</p>
<p>You should supply a function <code>fun</code> to set the way that the RasterLayers are combined. The number of arguments in the function must match the number of Raster objects (or take any number). For example, if you combine two RasterLayers you could use multiply: <code>fun=function(x,y){return(x*y)}</code> percentage: <code>fun=function(x,y){return(100 * x / y)}</code>. If you combine three layers you could use <code>fun=function(x,y,z){return((x + y) * z)}</code></p>
<p>Note that the function must work for vectors (not only for single numbers). That is, it must return the same number of elements as its input vectors. Alternatively, you can also supply a function such as <code>sum</code>, that takes <code>n</code> arguments (as <code>'...'</code>), and perhaps also has a <code>na.rm</code> argument, like in <code>sum(..., na.rm)</code>.</p>
<p>If a single mutli-layer object is provided, its layers are treated as individual RasterLayer objects if the argument <code>unstack=TRUE</code> is used. If multiple objects are provided, they should have the same number of layers, or it should be possible to recycle them (e.g., 1, 3, and 9 layers, which would return a RasterBrick with 9 layers).</p>
    </div>

    <pre class="usage"><span class='co'># S4 method for Raster,Raster</span>
<span class='fu'>overlay</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span>, <span class='va'>...</span>, <span class='va'>fun</span>, filename<span class='op'>=</span><span class='st'>""</span>, recycle<span class='op'>=</span><span class='cn'>TRUE</span>, forcefun<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span>

<span class='co'># S4 method for Raster,missing</span>
<span class='fu'>overlay</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span>, <span class='va'>...</span>, <span class='va'>fun</span>, filename<span class='op'>=</span><span class='st'>""</span>, unstack<span class='op'>=</span><span class='cn'>TRUE</span>, forcefun<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>Raster* object</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>Raster* object, or missing (only useful if <code>x</code> has multiple layers)</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional Raster objects (and/or arguments for writing files as in <code><a href='writeRaster.html'>writeRaster</a>)</code></p></td>
    </tr>
    <tr>
      <th>fun</th>
      <td><p>Function to be applied. When using RasterLayer objects, the number of arguments of the function should match the number of Raster objects, or it should take any number of arguments. When using multi-layer objects the function should match the number of layers of the RasterStack/Brick object (unless unstack=FALSE)</p></td>
    </tr>
    <tr>
      <th>filename</th>
      <td><p>Character. Output filename (optional)</p></td>
    </tr>
    <tr>
      <th>recycle</th>
      <td><p>Logical. Should layers from Raster objects with fewer layers be recycled?</p></td>
    </tr>
    <tr>
      <th>unstack</th>
      <td><p>Logical. Should layers be unstacked before computation (i.e. does the <code>fun</code> refer to individual layers in a multilayer object)?</p></td>
    </tr>
    <tr>
      <th>forcefun</th>
      <td><p>Boolean. If <code>TRUE</code>, overlay will not attempt to internally use apply (it is rarely necessary to use this argument)</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Instead of the overlay function you can also use arithmetic functions such as <code>*, /, +, -</code> with Raster objects (see examples). In that case you cannot specify an output filename. Moreover, the overlay function should be more efficient when using large data files that cannot be loaded into memory, as the use of the complex arithmetic functions might lead to the creation of many temporary files.</p>
<p>While you can supply functions such as <code>sum</code> or <code>mean</code>, it would be more direct to use the Raster* objects as arguments to those functions (e.g. <code>sum(r1,r2,r3)</code>)</p>
<p>See <code><a href='rasterize.html'>rasterize</a></code> and <code><a href='extract.html'>extract</a></code> for "overlays" involving Raster* objects and polygons, lines, or points.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Raster* object</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code> <a href='calc.html'>calc</a>,  <a href='Arith-methods.html'>Arith-methods</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='r-in'><span class='va'>r</span> <span class='op'>&lt;-</span> <span class='fu'><a href='raster.html'>raster</a></span><span class='op'>(</span>ncol<span class='op'>=</span><span class='fl'>10</span>, nrow<span class='op'>=</span><span class='fl'>10</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>r1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='initialize.html'>init</a></span><span class='op'>(</span><span class='va'>r</span>, fun<span class='op'>=</span><span class='va'>runif</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>r2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='initialize.html'>init</a></span><span class='op'>(</span><span class='va'>r</span>, fun<span class='op'>=</span><span class='va'>runif</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>r3</span> <span class='op'>&lt;-</span> <span class='fu'>overlay</span><span class='op'>(</span><span class='va'>r1</span>, <span class='va'>r2</span>, fun<span class='op'>=</span><span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>,<span class='va'>y</span><span class='op'>)</span><span class='op'>{</span><span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>+</span><span class='va'>y</span><span class='op'>)</span><span class='op'>}</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># long version for multiplication</span></span>
<span class='r-in'><span class='va'>r4</span> <span class='op'>&lt;-</span> <span class='fu'>overlay</span><span class='op'>(</span><span class='va'>r1</span>, <span class='va'>r2</span>, fun<span class='op'>=</span><span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>,<span class='va'>y</span><span class='op'>)</span><span class='op'>{</span><span class='op'>(</span><span class='va'>x</span><span class='op'>*</span><span class='va'>y</span><span class='op'>)</span><span class='op'>}</span> <span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>#use the individual layers of a RasterStack to get a RasterLayer</span></span>
<span class='r-in'><span class='va'>s</span> <span class='op'>&lt;-</span> <span class='fu'><a href='stack.html'>stack</a></span><span class='op'>(</span><span class='va'>r1</span>, <span class='va'>r2</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>r5</span> <span class='op'>&lt;-</span> <span class='fu'>overlay</span><span class='op'>(</span><span class='va'>s</span>, fun<span class='op'>=</span><span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>,<span class='va'>y</span><span class='op'>)</span> <span class='va'>x</span><span class='op'>*</span><span class='va'>y</span> <span class='op'>)</span></span>
<span class='r-in'><span class='co'># equivalent to</span></span>
<span class='r-in'><span class='va'>r5c</span> <span class='op'>&lt;-</span> <span class='fu'><a href='calc.html'>calc</a></span><span class='op'>(</span><span class='va'>s</span>, fun<span class='op'>=</span><span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='va'>x</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>*</span><span class='va'>x</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span> <span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>#Combine RasterStack and RasterLayer objects (s2 has four layers. </span></span>
<span class='r-in'><span class='co'># r1 (one layer) and s (two layers) are recycled) </span></span>
<span class='r-in'><span class='va'>s2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='stack.html'>stack</a></span><span class='op'>(</span><span class='va'>r1</span>, <span class='va'>r2</span>, <span class='va'>r3</span>, <span class='va'>r4</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>b</span> <span class='op'>&lt;-</span> <span class='fu'>overlay</span><span class='op'>(</span><span class='va'>r1</span>, <span class='va'>s</span>, <span class='va'>s2</span>, fun<span class='op'>=</span><span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>,<span class='va'>y</span>,<span class='va'>z</span><span class='op'>)</span><span class='op'>{</span><span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>*</span><span class='va'>y</span><span class='op'>*</span><span class='va'>z</span><span class='op'>)</span><span class='op'>}</span> <span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># use a single RasterLayer (same as calc function)</span></span>
<span class='r-in'><span class='va'>r6</span> <span class='op'>&lt;-</span> <span class='fu'>overlay</span><span class='op'>(</span><span class='va'>r1</span>, fun<span class='op'>=</span><span class='va'>sqrt</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># multiplication with more than two layers </span></span>
<span class='r-in'><span class='co'># (make sure the number of RasterLayers matches the arguments of 'fun')</span></span>
<span class='r-in'><span class='va'>r7</span> <span class='op'>&lt;-</span> <span class='fu'>overlay</span><span class='op'>(</span><span class='va'>r1</span>, <span class='va'>r2</span>, <span class='va'>r3</span>, <span class='va'>r4</span>, fun<span class='op'>=</span><span class='kw'>function</span><span class='op'>(</span><span class='va'>a</span>,<span class='va'>b</span>,<span class='va'>c</span>,<span class='va'>d</span><span class='op'>)</span><span class='op'>{</span><span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>a</span><span class='op'>*</span><span class='va'>b</span><span class='op'>+</span><span class='va'>c</span><span class='op'>*</span><span class='va'>d</span><span class='op'>)</span><span class='op'>}</span> <span class='op'>)</span>  </span>
<span class='r-in'><span class='co'># equivalent function, efficient if values can be loaded in memory</span></span>
<span class='r-in'><span class='va'>r8</span> <span class='op'>&lt;-</span> <span class='va'>r1</span> <span class='op'>*</span> <span class='va'>r2</span> <span class='op'>+</span> <span class='va'>r3</span> <span class='op'>*</span> <span class='va'>r4</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># Also works with multi-layer objects. </span></span>
<span class='r-in'><span class='va'>s1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='stack.html'>stack</a></span><span class='op'>(</span><span class='va'>r1</span>, <span class='va'>r2</span>, <span class='va'>r3</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'>overlay</span><span class='op'>(</span><span class='va'>s1</span>, <span class='va'>s1</span>, fun<span class='op'>=</span><span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>,<span class='va'>y</span><span class='op'>)</span><span class='va'>x</span><span class='op'>+</span><span class='va'>y</span><span class='op'>+</span><span class='fl'>5</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># in this case the first layer of the shorter object is recycled.</span></span>
<span class='r-in'><span class='co'># i.e., s2 is treated as stack(r1, r3, r1)</span></span>
<span class='r-in'><span class='va'>s2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='stack.html'>stack</a></span><span class='op'>(</span><span class='va'>r1</span>, <span class='va'>r3</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'>overlay</span><span class='op'>(</span><span class='va'>s1</span>, <span class='va'>s2</span>, fun<span class='op'>=</span><span class='va'>sum</span><span class='op'>)</span></span>
</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Robert J. Hijmans.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


